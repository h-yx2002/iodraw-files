```mermaid
graph TD
    %% ================= 输入与预处理 =================
    A[Input RGB Image] --> B[Lab Preprocess<br/>(Optional)]
    B --> C[Pre-ICR<br/>(HVI Color Correction)]
    C --> D[Frequency Enhancement<br/>(Input)]
    D --> E[RGB → HVI Transform]

    %% ================= HVI 分解 =================
    E -->|HV (2ch)| HV0
    E -->|I (1ch)| I0

    %% ================= HV 分支 =================
    HV0 -->|Optional| FDDM1[FDDM<br/>Pre-Encoder]
    FDDM1 --> HV_ENC0[HV Encoder 0]
    HV_ENC0 --> FE_HV0[Freq Enhance HV]
    FE_HV0 --> HV_ENC1[HV Encoder 1]
    HV_ENC1 --> HV_ENC2[HV Encoder 2]
    HV_ENC2 --> HV_ENC3[HV Encoder 3]

    %% ================= I 分支 =================
    I0 --> I_ENC0[I Encoder 0]
    I_ENC0 --> FE_I0[Freq Enhance I]
    FE_I0 --> I_ENC1[I Encoder 1]
    I_ENC1 --> I_ENC2[I Encoder 2]
    I_ENC2 --> I_ENC3[I Encoder 3]

    %% ================= Cross Attention =================
    HV_ENC1 <-->|Cross Attention| I_ENC1
    HV_ENC2 <-->|Cross Attention| I_ENC2
    HV_ENC3 <-->|Cross Attention| I_ENC3

    %% ================= Bottleneck =================
    HV_ENC3 -->|Optional| FDDM2[FDDM<br/>Bottleneck]
    FDDM2 --> HV_BOT[Bottleneck HV + DGD]
    I_ENC3 --> I_BOT[Bottleneck I + DGD]

    HV_BOT <-->|Cross Attention| I_BOT

    %% ================= Decoder =================
    HV_BOT --> HV_DEC3[HV Decoder 3]
    I_BOT --> I_DEC3[I Decoder 3]

    HV_DEC3 <-->|Cross Attention| I_DEC3

    HV_DEC3 --> HV_DEC2[HV Decoder 2]
    I_DEC3 --> I_DEC2[I Decoder 2]

    HV_DEC2 <-->|Cross Attention| I_DEC2

    HV_DEC2 --> HV_DEC1[HV Decoder 1]
    I_DEC2 --> I_DEC1[I Decoder 1]

    HV_DEC1 --> HV_OUT[HV Output (2ch)]
    I_DEC1 --> I_OUT[I Output (1ch)]

    %% ================= 融合与输出 =================
    HV_OUT --> CONCAT[Concat HV + I]
    I_OUT --> CONCAT

    CONCAT --> DGD[DGD Feature Fusion]
    DGD --> ADD[Residual + Input Freq]
    ADD --> HVI2RGB[HVI → RGB]
    HVI2RGB --> POST[Post Processing<br/>(Optional)]
    POST --> OUT[Final Enhanced RGB]
```